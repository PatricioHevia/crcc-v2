<div class="project-detail-container">
  <!-- Estado de carga -->
  <div *ngIf="loading()" class="loading-state">
    <div class="banner-skeleton">
      <p-skeleton height="500px" class="mb-2"></p-skeleton>
    </div>
    <div class="content-skeleton">
      <p-skeleton height="2rem" class="mb-3"></p-skeleton>
      <p-skeleton height="1rem" class="mb-2"></p-skeleton>
      <p-skeleton height="1rem" class="mb-2"></p-skeleton>
      <p-skeleton height="8rem" class="mb-3"></p-skeleton>
    </div>
  </div>

  <!-- Proyecto no encontrado -->
  <div *ngIf="notFound()" class="not-found-state">
    <p-message 
      severity="warn" 
      [text]="'PROJECTS.PROJECT_NOT_FOUND' | translate"
      styleClass="w-full">
    </p-message>
    <p class="redirect-message">
      {{ 'PROJECTS.REDIRECTING_TO_PROJECTS' | translate }}
    </p>
    <p-button 
      [label]="'COMMON.GO_BACK' | translate"
      icon="pi pi-arrow-left"
      (click)="goBack()">
    </p-button>
  </div>

  <!-- Contenido del proyecto -->
  <div *ngIf="!loading() && !notFound() && project()" class="project-content">
    <!-- Banner del proyecto -->
    <div class="project-banner">
      <div class="banner-image-container">
        <p-image 
          [src]="project()!.image"
          [alt]="getProjectName()"
          width="100%"
          height="500"
          [preview]="true"
          >
        </p-image>
        <div class="banner-overlay">
          <div class="banner-content">
            <h1 class="project-title">{{ getProjectName() }}</h1>
            <p-tag 
              *ngIf="project()!.phase"
              [value]="getPhaseTranslationKey() | translate"
              [ngClass]="getPhaseTagClasses()"
              class="phase-tag">
            </p-tag>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel de información del proyecto -->
    <div class="project-info-section">
      <p-panel [header]="'PROJECTS.PROJECT_INFORMATION' | translate" [toggleable]="false">
        <div class="info-grid">
          <!-- Descripción -->
          <div class="info-item description-item">
            <h3>{{ 'PROJECTS.DESCRIPTION' | translate }}</h3>
            <p class="description-text">{{ getProjectDescription() }}</p>
          </div>

          <!-- Detalles del proyecto -->
          <div class="info-item details-item">
            <div class="detail-row" *ngIf="project()!.awardDate">
              <strong class="text-end">{{ 'PROJECTS.START_DATE' | translate }}:</strong>
              <span>{{ project()!.awardDate?.toDate() | date:'dd/MM/yyyy HH:mm':undefined:lang()}}</span>
            </div>
            
            
            
            <div class="detail-row" *ngIf="project()!.phase">
              <strong class="text-end">{{ 'PROJECTS.TABLE.PHASE' | translate }}:</strong>
              <p-tag 
                [value]="getPhaseTranslationKey() | translate"
                [ngClass]="getPhaseTagClasses()"
                class="inline-phase-tag">
              </p-tag>
            </div>
            
            <div class="detail-row" *ngIf="project()!.url">
              <strong class="text-end">{{ 'PROJECTS.PROJECT_URL' | translate }}:</strong>
              <span class="project-url">{{ project()!.url }}</span>
            </div>
          </div>
        </div>

        <p-divider></p-divider>

        <!-- Botones de acción -->
        <div class="action-buttons">
          <p-button 
            [label]="'COMMON.GO_BACK' | translate"
            icon="pi pi-arrow-left"
            severity="secondary"
            (click)="goBack()">
          </p-button>
        </div>
      </p-panel>
    </div>    <!-- Galería de imágenes -->
    <div class="gallery-section">
      <p-panel [header]="'PROJECTS.IMAGE_GALLERY' | translate" [toggleable]="true" [collapsed]="false">
        <div class="gallery-container">
          
          <!-- Progreso de subida -->
          <div class="upload-progress" *ngIf="uploadLoading()">
            <p-progressSpinner
              styleClass="custom-spinner"
              strokeWidth="4">
            </p-progressSpinner>
            <span>{{ 'PROJECTS.GALLERY_MANAGEMENT.UPLOADING' | translate }}</span>
          </div>

          <!-- Controles de recorte -->
          <div class="crop-controls-inline" *ngIf="croppedImage && showCropper">
            <p-button
              [disabled]="uploadLoading()"
              icon="pi pi-check"
              [label]="'PROJECTS.GALLERY_MANAGEMENT.APPLY_CROP' | translate"
              severity="success"
              size="small"
              (click)="applyCrop()">
            </p-button>
            <p-button
              [disabled]="uploadLoading()"
              icon="pi pi-times"
              [label]="'PROJECTS.GALLERY_MANAGEMENT.CANCEL_CROP' | translate"
              severity="secondary"
              size="small"
              (click)="cancelCrop()">
            </p-button>
          </div>

          <!-- Botón para seleccionar imagen -->
          <p-button
            icon="pi pi-upload"
            [label]="'PROJECTS.GALLERY_MANAGEMENT.ADD_IMAGES' | translate"
            severity="info"
            size="small"
            (click)="openFileSelector()"
            [disabled]="uploadLoading()"
            class="add-image-btn">
          </p-button>
          
          <!-- Input file oculto -->
          <input
            #fileInput
            type="file"
            accept="image/*"
            hidden
            (change)="onFileSelected($event)">          <!-- Cropper simple con aspect ratio 16:9 -->
          <div *ngIf="imageChangedEvent" class="cropper-section">
            <h4 class="cropper-title">{{ 'PROJECTS.GALLERY_MANAGEMENT.CROP_IMAGE_TITLE' | translate }}</h4>
            <div class="cropper-container">
              <image-cropper
                [imageChangedEvent]="imageChangedEvent"
                [maintainAspectRatio]="true"
                [aspectRatio]="16 / 9"
                [resizeToWidth]="800"
                [cropperMinWidth]="320"
                [cropperMinHeight]="180"
                format="png"
                (imageCropped)="imageCropped($event)"
                (imageLoaded)="imageLoaded()"
                (cropperReady)="cropperReady()"
                (loadImageFailed)="loadImageFailed()">
              </image-cropper>
            </div>
            
            <!-- Solo botones de aplicar y cancelar -->
            <div class="crop-actions" *ngIf="showCropper">
              <p-button
                [disabled]="uploadLoading()"
                icon="pi pi-times"
                [label]="'PROJECTS.GALLERY_MANAGEMENT.CANCEL_CROP' | translate"
                severity="secondary"
                (click)="cancelCrop()">
              </p-button>
              <p-button
                [disabled]="uploadLoading()"
                icon="pi pi-check"
                [label]="'PROJECTS.GALLERY_MANAGEMENT.APPLY_CROP' | translate"
                severity="success"
                (click)="applyCrop()">
              </p-button>
            </div>
          </div>

          <!-- Galería de imágenes existentes -->
          <div *ngIf="project()?.galleryImages && project()!.galleryImages!.length > 0" class="gallery-grid">
            <div *ngFor="let image of project()!.galleryImages" class="gallery-item">
              <img 
                [src]="image.url"
                [alt]="image.name"
                class="gallery-thumbnail">
              <button
                class="delete-btn"
                (click)="deleteImage(image)"
                [pTooltip]="'PROJECTS.GALLERY_MANAGEMENT.DELETE_IMAGE' | translate">
                <i class="pi pi-trash"></i>
              </button>
              <div class="image-name">{{ image.name }}</div>
            </div>
          </div>

          <!-- Placeholder cuando no hay imágenes -->
          <div *ngIf="!project()?.galleryImages || project()!.galleryImages!.length === 0" class="gallery-placeholder">
            <div class="placeholder-content">
              <i class="pi pi-images placeholder-icon"></i>
              <h3>{{ 'PROJECTS.GALLERY_MANAGEMENT.NO_IMAGES' | translate }}</h3>
              <p>{{ 'PROJECTS.GALLERY_MANAGEMENT.NO_IMAGES_DESCRIPTION' | translate }}</p>
            </div>
          </div>        </div>
      </p-panel>
    </div>  </div>
</div>

